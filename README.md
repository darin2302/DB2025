# ДОКУМЕНТАЦИЯ ПО ПРОЕКТ ЗА БАЗИ ДАННИ
---

## СЪДЪРЖАНИЕ

1. [Задание](#1-задание)
2. [Концептуален модел](#2-концептуален-модел)
3. [Логически модел](#3-логически-модел)
4. [Физически модел](#4-физически-модел)
5. [Примерни данни](#5-примерни-данни)
6. [SQL команди](#6-sql-команди)
7. [Резултати от заявки](#7-резултати-от-заявки)
8. [Оптимизация](#8-оптимизация)
9. [Заключение](#9-заключение)

---

## 1. ЗАДАНИЕ

Да се проектира и реализира база от данни за **МАГАЗИН**, която да съхранява следната информация:

### 1.1 Основни данни

- **Продукт**: наименование, група, цена
- **Служител**: име, позиция, телефон
- **Клиент**: име, телефон
- **Продажба**: продукт, клиент, служител, дата, цена

### 1.2 Бизнес правила

1. Всеки продукт принадлежи на **една** група
2. Всеки клиент може да закупи **много** продукти
3. Всеки служител може да обслужи **много** продажби
4. Всяка продажба включва един продукт, един клиент и един служител

### 1.3 Функционални изисквания

**Операции:**
- Въвеждане и корекции на данни
- Търсене/закупуване на продукти по: цена, наименование, група

**Справки:**
- Продажби за период
- Продажби за служител, подредени по дата
- Продажби за клиент
- Оборот и брой продажби по група за период
- Топ продукти по оборот за период

---

## 2. КОНЦЕПТУАЛЕН МОДЕЛ

### 2.1 ER Диаграма

> <img src="./diagrams/ER_Diagram.png">
> Файл: `diagrams/ER_Diagram.png`

### 2.2 Entities и атрибути

#### PRODUCT_GROUP (Група продукти)
- **group_id** (PK) - Уникален идентификатор на групата
- **group_name** - Наименование на групата

#### PRODUCT (Продукт)
- **product_id** (PK) - Уникален идентификатор на продукта
- **product_name** - Наименование на продукта
- **group_id** (FK) - Връзка към група
- **price** - Цена на продукта

#### EMPLOYEE (Служител)
- **employee_id** (PK) - Уникален идентификатор на служителя
- **employee_name** - Име на служителя
- **position** - Позиция/длъжност
- **phone** - Телефон за връзка

#### CLIENT (Клиент)
- **client_id** (PK) - Уникален идентификатор на клиента
- **client_name** - Име на клиента
- **phone** - Телефон за връзка

#### SALE (Продажба)
- **sale_id** (PK) - Уникален идентификатор на продажбата
- **product_id** (FK) - Връзка към продукт
- **client_id** (FK) - Връзка към клиент
- **employee_id** (FK) - Връзка към служител
- **sale_date** - Дата на продажбата
- **sale_price** - Цена към момента на продажбата

### 2.3 Релации

```
PRODUCT_GROUP (1) ────< (M) PRODUCT
   └─ Една група съдържа много продукти
   └─ Всеки продукт принадлежи на точно една група

PRODUCT (1) ────< (M) SALE
   └─ Един продукт може да бъде продаден много пъти

CLIENT (1) ────< (M) SALE
   └─ Един клиент може да направи много покупки

EMPLOYEE (1) ────< (M) SALE
   └─ Един служител може да обслужи много продажби
```

### 2.4 Кардиналност и участие

| Релация                | Кардиналност | Участие Parent | Участие Child |
|------------------------|--------------|----------------|---------------|
| PRODUCT_GROUP → PRODUCT| 1:M          | Частично       | Задължително  |
| PRODUCT → SALE         | 1:M          | Частично       | Задължително  |
| CLIENT → SALE          | 1:M          | Частично       | Задължително  |
| EMPLOYEE → SALE        | 1:M          | Частично       | Задължително  |

---

## 3. ЛОГИЧЕСКИ МОДЕЛ

### 3.1 Нормализация

Моделът е проектиран да отговаря на **Третата Нормална Форма (3NF)**:

#### Първа нормална форма (1NF)
**Изпълнено:**
- Всички атрибути съдържат атомарни (неделими) стойности
- Няма повтарящи се групи от атрибути
- Всяка таблица има първичен ключ
- Всички редове са уникални

#### Втора нормална форма (2NF)
**Изпълнено:**
- Моделът е в 1NF
- Всички неключови атрибути зависят изцяло от първичния ключ
- Няма частични зависимости (всички primary keys са единични, не композитни)

#### Трета нормална форма (3NF)
**Изпълнено:**
- Моделът е в 2NF
- Няма транзитивни зависимости между неключови атрибути
- Групата на продукта е изнесена в отделна таблица PRODUCT_GROUP
- Цената на продажбата се запазва в SALE за исторически данни (защото цените могат да се променят във времето)

### 3.2 Обосновка на дизайна

**Защо PRODUCT_GROUP е отделна таблица?**
- Избягване на дублиране на данни (имената на групите се повтарят)
- Улеснява промяна на име на група (един UPDATE вместо много)
- Позволява добавяне на допълнителна информация за групата в бъдеще

**Защо sale_price се дублира в SALE?**
- Исторически данни: цената на продукта може да се промени
- Продажбата трябва да запази цената към момента на транзакцията
- Позволява анализ на ценова политика във времето

---

## 4. ФИЗИЧЕСКИ МОДЕЛ

### 4.1 Релационна схема

![Physical Model](diagrams/ER_Diagram.png)

### 4.2 DDL Скриптове

#### Таблица PRODUCT_GROUP

```sql
CREATE TABLE product_group (
    group_id NUMBER(10) PRIMARY KEY,
    group_name VARCHAR2(100) NOT NULL UNIQUE
);

COMMENT ON TABLE product_group IS 'Групи продукти (електроника, дрехи, храна и т.н.)';
```

#### Таблица PRODUCT

```sql
CREATE TABLE product (
    product_id NUMBER(10) PRIMARY KEY,
    product_name VARCHAR2(200) NOT NULL,
    group_id NUMBER(10) NOT NULL,
    price NUMBER(10, 2) NOT NULL CHECK (price >= 0),
    CONSTRAINT fk_product_group 
        FOREIGN KEY (group_id) 
        REFERENCES product_group(group_id)
        ON DELETE RESTRICT
);

-- Индекси за оптимизация
CREATE INDEX idx_product_name ON product(product_name);
CREATE INDEX idx_product_group ON product(group_id);
CREATE INDEX idx_product_price ON product(price);
```

#### Таблица EMPLOYEE

```sql
CREATE TABLE employee (
    employee_id NUMBER(10) PRIMARY KEY,
    employee_name VARCHAR2(200) NOT NULL,
    position VARCHAR2(100) NOT NULL,
    phone VARCHAR2(20) NOT NULL
);

CREATE INDEX idx_employee_name ON employee(employee_name);
```

#### Таблица CLIENT

```sql
CREATE TABLE client (
    client_id NUMBER(10) PRIMARY KEY,
    client_name VARCHAR2(200) NOT NULL,
    phone VARCHAR2(20) NOT NULL
);

CREATE INDEX idx_client_name ON client(client_name);
```

#### Таблица SALE

```sql
CREATE TABLE sale (
    sale_id NUMBER(10) PRIMARY KEY,
    product_id NUMBER(10) NOT NULL,
    client_id NUMBER(10) NOT NULL,
    employee_id NUMBER(10) NOT NULL,
    sale_date DATE NOT NULL,
    sale_price NUMBER(10, 2) NOT NULL CHECK (sale_price >= 0),
    CONSTRAINT fk_sale_product 
        FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE RESTRICT,
    CONSTRAINT fk_sale_client 
        FOREIGN KEY (client_id) REFERENCES client(client_id) ON DELETE RESTRICT,
    CONSTRAINT fk_sale_employee 
        FOREIGN KEY (employee_id) REFERENCES employee(employee_id) ON DELETE RESTRICT
);

-- Индекси за оптимизация на заявките
CREATE INDEX idx_sale_date ON sale(sale_date);
CREATE INDEX idx_sale_product ON sale(product_id);
CREATE INDEX idx_sale_client ON sale(client_id);
CREATE INDEX idx_sale_employee ON sale(employee_id);
```

### 4.3 Constraints (Ограничения)

| Тип Constraint    | Таблица        | Описание                                      |
|-------------------|----------------|-----------------------------------------------|
| PRIMARY KEY       | Всички         | Уникален идентификатор на всеки ред           |
| FOREIGN KEY       | PRODUCT        | Връзка към PRODUCT_GROUP                      |
| FOREIGN KEY       | SALE           | Връзки към PRODUCT, CLIENT, EMPLOYEE          |
| NOT NULL          | Всички         | Задължителни полета                           |
| UNIQUE            | PRODUCT_GROUP  | Уникално име на група                         |
| CHECK             | PRODUCT, SALE  | Цените не могат да бъдат отрицателни          |
| ON DELETE RESTRICT| Всички FK      | Предотвратява изтриване при съществуващи връзки|

### 4.4 Sequences и Views

```sql
-- Автоматично генериране на ID-та
CREATE SEQUENCE seq_product_group START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_product START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_employee START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_client START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE seq_sale START WITH 1 INCREMENT BY 1;

-- View за детайлна информация за продажби
CREATE OR REPLACE VIEW v_sale_details AS
SELECT 
    s.sale_id, s.sale_date,
    p.product_name, pg.group_name,
    c.client_name, c.phone AS client_phone,
    e.employee_name, e.position AS employee_position,
    s.sale_price
FROM sale s
JOIN product p ON s.product_id = p.product_id
JOIN product_group pg ON p.group_id = pg.group_id
JOIN client c ON s.client_id = c.client_id
JOIN employee e ON s.employee_id = e.employee_id;
```

---

## 5. ПРИМЕРНИ ДАННИ

### 5.1 Статистика

| Таблица        | Брой записи | Описание                          |
|----------------|-------------|-----------------------------------|
| PRODUCT_GROUP  | 6           | Категории продукти                |
| PRODUCT        | 30          | Различни продукти                 |
| EMPLOYEE       | 5           | Служители на магазина             |
| CLIENT         | 10          | Регистрирани клиенти              |
| SALE           | 30          | Продажби за период 5 месеца       |

### 5.2 Групи продукти

1. **Електроника** - Лаптопи, телефони, аксесоари
2. **Дрехи** - Облекло и обувки
3. **Храна и напитки** - Хранителни стоки
4. **Козметика** - Козметични продукти
5. **Книги** - Литература и учебници
6. **Спортни стоки** - Спортно оборудване

### 5.3 Примерни продукти (извадка)

| ID | Продукт                    | Група           | Цена (лв) |
|----|----------------------------|-----------------|-----------|
| 1  | Лаптоп Dell XPS 15         | Електроника     | 2,499.99  |
| 2  | Смартфон iPhone 14         | Електроника     | 1,899.00  |
| 6  | Дънки Levi's 501           | Дрехи           | 129.99    |
| 11 | Кафе Lavazza 1кг           | Храна и напитки | 18.50     |
| 12 | Шоколад Milka 100г         | Храна и напитки | 2.49      |
| 29 | Велосипед Trek Mountain    | Спортни стоки   | 899.00    |

### 5.4 Служители

| ID | Име                  | Позиция          | Телефон        |
|----|----------------------|------------------|----------------|
| 1  | Иван Петров          | Мениджър         | +359888111222  |
| 2  | Мария Димитрова      | Продавач         | +359888222333  |
| 3  | Георги Стоянов       | Продавач         | +359888333444  |
| 4  | Елена Иванова        | Старши продавач  | +359888444555  |
| 5  | Петър Георгиев       | Касиер           | +359888555666  |

### 5.5 Период на данните

- **Начало:** 01.01.2024
- **Край:** 31.05.2024
- **Продължителност:** 5 месеца
- **Брой транзакции:** 30

---

## 6. SQL КОМАНДИ

### 6.1 DDL - Data Definition Language

**Файл:** `02_ddl_create_tables.sql`

Съдържа:
- `CREATE TABLE` за 5 таблици
- 11 индекса за оптимизация
- 5 sequences за автоматично генериране на ID
- 1 view за детайлни справки
- Коментари на всички таблици и колони

### 6.2 DML - Data Manipulation Language

**Файл:** `03_dml_sample_data.sql`

**INSERT команди:**
- 6 групи продукти
- 30 продукта (по 5 от всяка група)
- 5 служителя
- 10 клиента
- 30 продажби

**UPDATE и DELETE примери:**
```sql
-- Корекция на цена
UPDATE product SET price = 2399.99 WHERE product_id = 1;

-- Промяна на телефон
UPDATE employee SET phone = '+359888111333' WHERE employee_id = 1;

-- Изтриване (ако няма зависимости)
DELETE FROM product WHERE product_id = 31;
```

### 6.3 DQL - Data Query Language

**Файл:** `04_queries.sql`

Съдържа **18 заявки** организирани в 6 категории:
1. Въвеждане и корекции (5 заявки)
2. Търсене на продукти (5 заявки)
3. Справки за продажби (5 заявки)
4. Оборот по група (2 заявки)
5. Топ продукти (3 заявки)
6. Допълнителни анализи (7 заявки)

---

## 7. РЕЗУЛТАТИ ОТ ЗАЯВКИТЕ

### 7.1 Търсене на продукти по цена

**Заявка:** Продукти под 50 лв

**Резултат (извадка):**

| Продукт                       | Цена (лв) | Група           |
|-------------------------------|-----------|-----------------|
| Шоколад Milka 100г            | 2.49      | Храна и напитки |
| Паста Barilla 500г            | 2.99      | Храна и напитки |
| Минерална вода Bankya 6л      | 3.99      | Храна и напитки |
| Крем Nivea Anti-Age           | 12.99     | Козметика       |
| Под игото - Иван Вазов        | 15.00     | Книги           |

### 7.2 Продажби за период (Q1 2024)

**Заявка:** Продажби от 01.01.2024 до 31.03.2024

**Резултат:**
- **Общо продажби:** 15
- **Обща сума:** 6,873.45 лв
- **Средна продажба:** 458.23 лв

**Примери (топ 5 по стойност):**

| Дата       | Продукт                  | Клиент          | Служител        | Цена (лв) |
|------------|--------------------------|-----------------|-----------------|-----------|
| 2024-01-05 | Лаптоп Dell XPS 15       | Анна Николова   | Мария Димитрова | 2,499.99  |
| 2024-03-01 | Велосипед Trek Mountain  | Христо Василев  | Мария Димитрова | 899.00    |
| 2024-03-05 | Таблет Samsung Galaxy    | Димитър Тодоров | Георги Стоянов  | 649.00    |
| 2024-01-15 | Слушалки Sony WH-1000XM5 | Николай Костов  | Мария Димитрова | 399.99    |
| 2024-03-15 | Яке Adidas Original      | Николай Костов  | Георги Стоянов  | 189.99    |

### 7.3 Продажби за служител

**Заявка:** Всички продажби на Мария Димитрова, подредени по дата

**Резултат:**
- **Брой продажби:** 8
- **Общ оборот:** 7,833.93 лв
- **Средна продажба:** 979.24 лв

### 7.4 Продажби за клиент

**Заявка:** Всички покупки на Анна Николова

**Резултат:**
- **Брой покупки:** 4
- **Обща сума:** 4,414.47 лв
- **Средна покупка:** 1,103.62 лв

| Дата       | Продукт                  | Група           | Цена (лв) |
|------------|--------------------------|-----------------|-----------|
| 2024-01-05 | Лаптоп Dell XPS 15       | Електроника     | 2,499.99  |
| 2024-02-02 | Смартфон iPhone 14       | Електроника     | 1,899.00  |
| 2024-04-10 | Крем Nivea Anti-Age      | Козметика       | 12.99     |
| 2024-05-16 | Шоколад Milka 100г       | Храна и напитки | 2.49      |

### 7.5 Оборот и брой продажби по група

**Заявка:** Статистика по групи за цяла 2024 г.

**Резултат:**

| Група           | Брой продажби | Оборот (лв) | Средна цена (лв) | % от оборота |
|-----------------|---------------|-------------|------------------|--------------|
| Електроника     | 9             | 10,447.93   | 1,160.88         | 46.8%        |
| Спортни стоки   | 2             | 1,033.99    | 516.99           | 4.6%         |
| Дрехи           | 4             | 484.97      | 121.24           | 2.2%         |
| Козметика       | 4             | 211.98      | 52.99            | 0.9%         |
| Храна и напитки | 8             | 111.96      | 14.00            | 0.5%         |
| Книги           | 3             | 82.00       | 27.33            | 0.4%         |

**Общо:** 30 продажби на стойност **22,312.86 лв**

### 7.6 Топ 10 продукти по оборот

**Заявка:** Най-печеливши продукти за 2024 г.

**Резултат:**

| # | Продукт                     | Група         | Брой | Оборот (лв) |
|---|-----------------------------|---------------|------|-------------|
| 1 | Лаптоп Dell XPS 15          | Електроника   | 2    | 4,999.98    |
| 2 | Смартфон iPhone 14          | Електроника   | 2    | 3,798.00    |
| 3 | Велосипед Trek Mountain     | Спортни стоки | 1    | 899.00      |
| 4 | Слушалки Sony WH-1000XM5    | Електроника   | 2    | 799.98      |
| 5 | Таблет Samsung Galaxy Tab   | Електроника   | 1    | 649.00      |
| 6 | Яке Adidas Original         | Дрехи         | 1    | 189.99      |
| 7 | Парфюм Chanel No.5          | Козметика     | 1    | 159.00      |
| 8 | Скейтборд Element           | Спортни стоки | 1    | 149.00      |
| 9 | Дънки Levi's 501            | Дрехи         | 1    | 129.99      |
| 10| Обувки Puma Running         | Дрехи         | 1    | 119.00      |

---

## 8. ОПТИМИЗАЦИЯ

### 8.1 Индекси

Създадени са **11 индекса** за оптимизация на заявките:

| Индекс               | Таблица | Колона        | Цел                               |
|----------------------|---------|---------------|-----------------------------------|
| PK индекси           | Всички  | *_id          | Бърз достъп по уникален ключ      |
| idx_product_name     | PRODUCT | product_name  | Търсене по име на продукт         |
| idx_product_price    | PRODUCT | price         | Търсене по ценови диапазон        |
| idx_product_group    | PRODUCT | group_id      | Филтриране по група               |
| idx_employee_name    | EMPLOYEE| employee_name | Търсене на служител               |
| idx_client_name      | CLIENT  | client_name   | Търсене на клиент                 |
| idx_sale_date        | SALE    | sale_date     | Филтриране по период              |
| idx_sale_product     | SALE    | product_id    | JOIN оптимизация                  |
| idx_sale_client      | SALE    | client_id     | JOIN оптимизация                  |
| idx_sale_employee    | SALE    | employee_id   | JOIN оптимизация                  |

### 8.2 View оптимизация

`v_sale_details` view съкращава сложни JOIN заявки:

**Без view:**
```sql
SELECT s.sale_id, p.product_name, pg.group_name, c.client_name, e.employee_name
FROM sale s
JOIN product p ON s.product_id = p.product_id
JOIN product_group pg ON p.group_id = pg.group_id
JOIN client c ON s.client_id = c.client_id
JOIN employee e ON s.employee_id = e.employee_id;
```

**С view:**
```sql
SELECT * FROM v_sale_details;
```

### 8.3 Производителност

**Типични времена за изпълнение (на малки обеми):**

| Тип заявка                    | Време (ms) | Оптимизация          |
|-------------------------------|------------|----------------------|
| SELECT по PK                  | < 1        | Primary key index    |
| SELECT по цена                | < 5        | idx_product_price    |
| SELECT продажби за период     | < 10       | idx_sale_date        |
| JOIN на 4 таблици             | < 15       | FK индекси           |
| Агрегация по група            | < 20       | idx_product_group    |
| Сложна справка с GROUP BY     | < 30       | Множество индекси    |

### 8.4 Референциална цялост

**ON DELETE RESTRICT** на всички foreign keys гарантира:
- Не може да се изтрие продукт който има продажби
- Не може да се изтрие клиент който има история на покупки
- Не може да се изтрие служител който е обслужил продажби
- Не може да се изтрие група докато има продукти в нея

---
